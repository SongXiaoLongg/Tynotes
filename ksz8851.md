# 1 初始化

1. 软件复位
2. 获取ID
3. 写MAC，读MAC
4. 使能 写指针自动增长
5. 使能 添加发送帧校验和
6. 使能 读指针自动增长
7. 设置接收帧数阈值为1
8. 使能 添加接收帧校验和
9. 设置RXQCR
   1. 使能阈值溢出中断
   2. 使能IP头双字节偏移
   3. 使能接收缓冲区自动出队，读指针自动调整到下一帧数据所在的位置
10. 调整SPI 数据输出延时
11. 使能端口自动协商
12. 清除中断状态
13. 设置4k-12k的可用缓冲区空间
14. 使能中断
15. 发送使能
16. 接收使能

# 2 发送数据

1. 确认内存容量

   1. 写入下一帧的长度

      ```c
        txPacketLength = pTXLength(上层传来的数据) + 8;
      ```

   2. 使能内存可用中断位

   3. 确认中断状态位，有中断标志跳出循环

2. 清除中断标志

3. 屏蔽所有中断

4. 开启DMA访问

5. 写发送队列

6. 停止DMA访问

7. 启动传输当前帧寄存器内的数据：TXQ_ENQUEUE

8. 等待传输完成

9. 开启中断

# 3 接收数据

1. 查询中断状态

2. 判断中断状态

3. 屏蔽中断

4. 清除中断状态位

5. 读取帧数

6. 根据帧数读循环

   1. 读取接收帧头状态信息并判断

   2. 读取帧长度：rxPacketLength

      ```c
      bytesToRead = 4 * ((rxPacketLength + 3) >> 2) ？？？？？？
      ```

   3. 重置读指针

   4. 开启DMA访问，使能读指针自动调整

   5. 读取接收队列的数据，（读取到一帧数据便退出）

   6. 停止DMA访问

   7. 开启中断

   8. 返回 len

